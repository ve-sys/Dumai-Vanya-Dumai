import DB
import disnake
from disnake.ext import commands
import random
token=open("Ğ˜Ğ½Ñ„Ğ° Ğ¿Ñ€Ğ¾ Ğ±Ğ¾Ñ‚Ğ°.txt").readline()[6:]
bot = commands.Bot(command_prefix='$', help_command=None, intents=disnake.Intents.all())
pseudotheme = ['1.Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ»ĞµĞºĞ°Ñ€ÑÑ‚Ğ²Ğ° Ğ¾Ñ‚ Ñ€Ğ°ĞºĞ°. ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸) @ĞĞ´Ğ¼Ğ¸Ğ½',
                       '2.Ğ¡Ğ¿Ğ°ÑĞµĞ½Ğ¸Ğµ ÑĞ¸Ğ±Ğ¸Ñ€ÑĞºĞ¾Ğ³Ğ¾ Ñ€Ğ¾ĞºĞ°. ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸) @ĞĞ´Ğ¼Ğ¸Ğ½',
                       '3.Ğ’ĞµÑ‡Ğ½Ñ‹Ğ¹ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ. ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸) @ĞĞ´Ğ¼Ğ¸Ğ½',
                       '1.ĞŸĞµÑ‚ÑƒĞ½Ğ¸Ğ¸. ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸) @ĞĞ´Ğ¼Ğ¸Ğ½',
                       '2.Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ´Ğ»Ñ 5 ĞºĞ»Ğ°ÑÑĞ°. ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸) @ĞĞ´Ğ¼Ğ¸Ğ½',
                       '3.Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¸Ğ½Ğ´Ğ¸ Ğ¸Ğ³Ñ€. ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸) @ĞĞ´Ğ¼Ğ¸Ğ½']
prfl= ["Ğ‘Ğ¸Ğ¾Ñ…Ğ¸Ğ¼","Ğ¡Ğ¾Ñ†ÑĞºĞ¾Ğ½Ğ¾Ğ¼","Ğ¤Ğ¸Ğ·Ğ¼Ğ°Ñ‚"]
sprfl=['ğŸ¦ ','ğŸ“‹','ğŸ”©']
eprfl=['ğŸ§¬','ğŸ“ˆ','âš™ï¸']
@bot.event
async def on_ready():
    print(f"Device {bot.user} is set and ready to go")
    game = disnake.Game("Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…")
    await bot.change_presence(status=disnake.Status.online, activity=game)
    global guild
    guild = bot.guilds[0]
    global basedstrE
    global basedstrS
    basedstrE = 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!\nĞ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ğ¸ Ñ‚ĞµĞ¼Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² \nĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'
    basedstrS = 'Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ° - Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ°Ğ¼ Ñ‚ĞµĞ¼Ñƒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°.\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°ĞºĞ¾Ğ¹ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚'
    for i in range(len(prfl)):
            basedstrE += f'\n{eprfl[i]} - {prfl[i]}'
            basedstrS += f'\n{sprfl[i]} - {prfl[i]}'
@bot.event
async def on_message(message):
    print(f'{message.author}|{message.author.id}|{message.content}:')
    # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° ÑĞµÑ€Ğ²Ğ°ĞºĞµ
    if message.author != bot.user:
        if message.content.startswith('init'):
            mess = 'Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ñ‡Ğ½ĞµĞ¼!\nĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ\n\nâ” - Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ¸Ñ‰Ğ¸Ñ‚Ğµ Ñ‚ĞµĞ¼Ñƒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°' \
               '\nğŸ¯ - Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ¸Ğ´ĞµÑ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ'
            msg = await message.channel.send(mess)
            await msg.add_reaction('â”')
            await msg.add_reaction('ğŸ¯')
            print(f'{message.author}|{message.author.id}|{message.content}:')
        global guild
        uroles = []
        for x in (guild.get_member(message.author.id).roles):
            uroles.append(x.name)
        if message.content.startswith('!Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ'):
            global pseudotheme
            if "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµĞ¼" in uroles:
                msg = message.content
                for h in range(1, len(uroles)):
                    if uroles[h] in prfl:
                        prf=uroles[h]
                await message.channel.send(DB.addtheme(msg, message.author.id, prf))
            elif "Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼" in uroles:
                await message.channel.send('Ğ’Ğ°Ğ¼ Ğ½Ğµ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ')
        if message.content.startswith('!ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ'):
            if "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµĞ¼" in uroles:
                msg = message.content
                await message.channel.send(DB.removetheme(msg, message.author.id))
            elif "Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼" in uroles:
                await message.channel.send('Ğ•ÑĞ»Ğ¸ Ñ‚ĞµĞ¼Ğ° Ğ½Ğ°Ñ€ÑƒÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñƒ')
        if message.content.startswith('!Ğ¼Ğ¾Ğ¸ Ñ‚ĞµĞ¼Ñ‹'):
            await message.channel.send(DB.mytheme(message.author.id))
        if message.content.startswith('!Ğ¾Ñ‚Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ'):
            tema=message.content.replace("!Ğ¾Ñ‚Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ ","",1)
            await message.author.send(DB.follow(tema, message.author.id, False))

@bot.event
async def on_raw_reaction_add(date):
    global guild
    print('+' + str(date.emoji))
    # Ğ’Ñ‹Ğ´Ğ°ĞµÑ‚ÑÑ Ñ€Ğ¾Ğ»ÑŒ Ğ¸Ñ‰ÑƒÑ‰ĞµĞ³Ğ¾ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ÑÑ‰ĞµĞ³Ğ¾
    member = guild.get_member(date.user_id)
    if member != bot.user:
        uroles = []
        for x in (member.roles):
            uroles.append(x.name)
        if str(date.emoji) == 'ğŸ¯':
            role = disnake.utils.get(guild.roles, name="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµĞ¼")
            role2 = disnake.utils.get(guild.roles, name="Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼")
            print(guild, member)
            await member.add_roles(role)
            await member.remove_roles(role2)
            global prfl
            for i in uroles:
                if i in prfl:
                    Role = disnake.utils.get(guild.roles, name=i)
                    await member.remove_roles(Role)
            global basedstrE
            mess = basedstrE
            msg = await member.send(mess)
            await msg.add_reaction('ğŸ§¬')
            await msg.add_reaction('âš™ï¸')
            await msg.add_reaction('ğŸ“ˆ')
        if str(date.emoji) == 'â”':
            role = disnake.utils.get(guild.roles, name="Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼")
            role2 = disnake.utils.get(guild.roles, name="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµĞ¼")
            print(guild, member)
            await member.add_roles(role)
            await member.remove_roles(role2)
            global basedstrS
            mess = basedstrS
            msg = await member.send(mess)
            await msg.add_reaction('ğŸ¦ ')
            await msg.add_reaction('ğŸ”©')
            await msg.add_reaction('ğŸ“‹')
        print(uroles)
        # Ğ’Ñ‹Ğ´Ğ°ĞµÑ‚ÑÑ Ñ€Ğ¾Ğ»ÑŒ Ğ‘Ğ¸Ğ¾Ñ…Ğ¸Ğ¼/Ğ¤Ğ¸Ğ·Ğ¼Ğ°Ñ‚/Ğ¡Ğ¾Ñ†ÑĞº Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ÑÑ‰ĞµĞ¼Ñƒ (Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶ĞµĞ½)
        global pseudotheme
        global eprfl
        global sprfl
        if str(date.emoji) in eprfl and member != bot.user and "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµĞ¼" in uroles:
            print(guild, member)
            for l in eprfl:
                if str(date.emoji) == l:
                    role = disnake.utils.get(guild.roles, name=prfl[eprfl.index(str(date.emoji))])
                    await member.add_roles(role)
                    mess = f'Ğ˜Ñ‚Ğ°Ğº, Ğ²Ğ°Ñˆ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ -{prfl[eprfl.index(str(date.emoji))]}\nĞ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ "!Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ"'
                    await member.send(mess)
                    print(l + "send", prfl[eprfl.index(str(date.emoji))])
                else:
                    role2 = disnake.utils.get(guild.roles, name=prfl[eprfl.index(l)])
                    await member.remove_roles(role2)
                    print(l + "los")
                print(member.roles)
        # Ğ’Ñ‹Ğ´Ğ°ĞµÑ‚ÑÑ Ñ€Ğ¾Ğ»ÑŒ Ğ‘Ğ¸Ğ¾Ñ…Ğ¸Ğ¼/Ğ¤Ğ¸Ğ·Ğ¼Ğ°Ñ‚/Ğ¡Ğ¾Ñ†ÑĞº Ğ¸Ñ‰ÑƒÑ‰ĞµĞ¼Ñƒ (Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶ĞµĞ½ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€)
        if "Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼" in uroles and str(date.emoji) in sprfl:
            role = disnake.utils.get(guild.roles, name=prfl[sprfl.index(str(date.emoji))])
            print(guild, member)
            await member.add_roles(role)
            mess = 'Ğ”Ğ»Ñ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ñ‚ĞµĞ¼Ñƒ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ğŸ”„'
            msg = await member.send(mess)
            await msg.add_reaction('ğŸ”„')
        # Ğ’Ñ‹Ğ´Ğ°Ñ‡Ğ° Ñ‚ĞµĞ¼Ñ‹ Ğ¸Ñ‰ÑƒÑ‰ĞµĞ¼Ñƒ
        if str(date.emoji) == 'ğŸ”„':
            # print(pseudotheme)
            if len(uroles) > 2:
                prf = []
                for h in uroles:
                    if h in prfl:
                        prf.append(h)
                tema = DB.gettema(prf)
                mess = random.choice(tema)
                msg = await member.send(mess[0]+" ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸):"+mess[1][2:])
                await msg.add_reaction('ğŸ”„')
                await msg.add_reaction('âœ…')
        if str(date.emoji) == 'âœ…' and "Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼" in uroles:
            channel=await member.create_dm()
            msg=await channel.fetch_message(date.message_id)
            out=msg.content[:msg.content.index(" ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»(Ğ¸):")]
            print(out)
            await member.send(DB.follow(out,date.user_id,True))
@bot.event
async def on_raw_reaction_remove(date):
    global guild
    member = guild.get_member(date.user_id)
    uroles = []
    for x in (member.roles):
        uroles.append(x.name)
    print(uroles)
    print('-' + str(date.emoji))
    if member != bot.user:
        if str(date.emoji) == 'ğŸ¯' and "Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼" in uroles:
            role = disnake.utils.get(guild.roles, name="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµĞ¼")
            print(guild, member)
            await member.remove_roles(role)
        if str(date.emoji) == 'â”' and "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµĞ¼" in uroles:
            role = disnake.utils.get(guild.roles, name="Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼")
            print(guild, member)
            await member.remove_roles(role)
        if str(date.emoji) == 'ğŸ§¬' or str(date.emoji) == 'ğŸ¦ ':
            role = disnake.utils.get(guild.roles, name="Ğ‘Ğ¸Ğ¾Ñ…Ğ¸Ğ¼")
            print(guild, member)
            await member.remove_roles(role)
        if str(date.emoji) == 'âš™ï¸' or str(date.emoji) == 'ğŸ”©':
            role = disnake.utils.get(guild.roles, name="Ğ¤Ğ¸Ğ·Ğ¼Ğ°Ñ‚")
            print(guild, member)
            await member.remove_roles(role)
        if str(date.emoji) == 'ğŸ“ˆ' or str(date.emoji) == 'ğŸ“‹':
            role = disnake.utils.get(guild.roles, name="Ğ¡Ğ¾Ñ†ÑĞºĞ¾Ğ½Ğ¾Ğ¼")
            print(guild, member)
            await member.remove_roles(role)
        if str(date.emoji) == 'âœ…' and "Ğ˜Ñ‰ÑƒÑ‰Ğ¸Ğµ Ñ‚ĞµĞ¼" in uroles:
            channel=await member.create_dm()
            msg=await channel.fetch_message(date.message_id)
            await member.send(DB.follow(msg.content,date.user_id,False))


bot.run(token)
